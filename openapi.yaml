openapi: 3.0.3
info:
    title: Grocery lists backend - OpenAPI 3.0
    description: |-
        This is a Grocery lists backend server based on the OpenAPI 3.0 specification.
        Some useful links:
        - [Grocery lists backend repository](https://github.com/LongWyrsch/GroceryLists_backend)

    termsOfService: https://mygrocerylists.netlify.app/tos
    contact:
        email: long.nqw@gmail.com
    version: 1.0.0
servers:
    - url: https://mygrocerylists.up.railway.app
tags:
    - name: auth
      description: Authenticating users
    - name: recipes
      description: Access recipes
    - name: lists
      description: Access lists
    - name: users
      description: Managing user accounts
paths:
    /auth/google:
        get:
            tags:
                - auth
            summary: 'Step 1 in Google OAuth 2.0 authentication'
            description: 'Redirect user to Google OAuth 2.0 page'
            operationId: googleAuthPt1
            responses:
                '302':
                    description: Found
    /auth/google/callback:
        get:
            tags:
                - auth
            summary: 'Step 2 in Google OAuth 2.0 authentication'
            description: Google redirects user to server along with the profile and authorization code
            operationId: googleAuthPt2
            responses:
                '302':
                    description: Successfully authenticated. Redirecting user to home.
                    headers:
                        location:
                            schema:
                                type: string
                                example: https://mygrocerylists.netlify.app/home/lists
                            description: Redirect user to home
                        set-cookie:
                            schema:
                                type: string
                                example: connect.sid=...
                            description: user session cookie
    /auth/local/signin:
        post:
            tags:
                - auth
            summary: Local signin
            description: Sing in with email and password
            operationId: localSignin
            requestBody:
                description: User email and password
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                email:
                                    type: string
                                    format: email
                                    example: 'example@domain.com'
                                password:
                                    type: string
                                    format: password
                                    example: 123password
                required: true
            responses:
                '200':
                    description: 'User successfully authenticated'
                '403':
                    description: 'Wrong credentials provided'
                '500':
                    description: ' Internal Server Error'
    /auth/local/signup:
        post:
            tags:
                - auth
            summary: Local signup
            description: Sign up with email and password
            operationId: localSignup
            requestBody:
                description: User email and password
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                email:
                                    type: string
                                    format: email
                                    example: 'example@domain.com'
                                password:
                                    type: string
                                    format: password
                                    example: 123password
                                language:
                                    type: string
                                    example: 'EN'
                                theme:
                                    type: string
                                    example: light
                required: true
            responses:
                '201':
                    description: 'User successfully authenticated'
                '403':
                    description: 'User with that email already exists.'
                '500':
                    description: 'Supabase returned more than 1 user matching a given email.'
                '502':
                    description: 'Database return an error'
    /users:
        get:
            tags:
                - users
            summary: Get user
            description: Get user
            operationId: getUser
            responses:
                '200':
                    description: User fetched successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/User'
                '401':
                    description: Unauthorized
        put:
            tags:
                - users
            summary: Update user
            description: Update user
            operationId: updateUser
            requestBody:
                $ref: '#/components/requestBodies/User'
            responses:
                '200':
                    description: User successfully updated
                '400':
                    description: User input invalid
                '401':
                    description: Unauthorized
                '500':
                    description: More than one user match provided email
                '403':
                    description: User with that email already exists
                '502':
                    description: Database update operation failed
        delete:
            tags:
                - users
            summary: Delete user
            description: Delete user
            operationId: deleteUser
            responses:
                '200':
                    description: User successfully deleted
                '401':
                    description: Unauthorized
                '403':
                    description: Cannot delete admin
                '502':
                    description: Database delete operation failed
    /users/signout:
        get:
            tags:
                - users
            summary: Sign user out
            description: Sign user out
            operationId: userSignout
            responses:
                '200':
                    description: User successfully signed
                '401':
                    description: Unauthorized
    /recipes:
        get:
            tags:
                - recipes
            summary: Get all recipes
            description: Get all recipes
            operationId: allRecipies
            responses:
                '200':
                    description: Recipes fetched successfully
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    type: array
                                    items:
                                        $ref: '#/components/schemas/RecipeIngredient'
                '204':
                    description: 'User has no recipes'
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    type: string
                                example: []
                '401':
                    description: Unauthorized
                '502':
                    description: 'Database select operation failed'
        put:
            tags:
                - recipes
            summary: Update or add recipe ingredient
            description: Update or add recipe ingredient
            operationId: updateAddRecipeIngredient
            requestBody:
                $ref: '#/components/requestBodies/Recipe'
            responses:
                '200':
                    description: Recipe ingredient successfully updated
                '401':
                    description: Unauthorized
                '502':
                    description: 'Database update operation failed'
    /recipes/delete:
        put:
            tags:
                - recipes
            summary: Delete recipe or recipe ingredients
            description: Delete recipe or recipe ingredients
            operationId: deleteRecipeIngredient
            requestBody:
                description: Recipe uuid or array of ingredient uuids
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                row_uuid:
                                    type: array
                                    items:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                card_uuid:
                                    type: string
                                    format: uuid
                                    example: '123e4567-e89b-12d3-a456-426614174000'
                required: true
            responses:
                '200':
                    description: Recipe ingredient successfully deleted
                '401':
                    description: Unauthorized
                '502':
                    description: 'Database delete operation failed'
    /recipes/join:
        post:
            tags:
                - recipes
            summary: Create new recipe
            description: Create new recipe
            operationId: createRecipe
            requestBody:
                description: Recipe uuids to add to the new list
                required: true
                content:
                    application/json:
                        schema:
                            type: array
                            items:
                                type: string
                                example: '123e4567-e89b-12d3-a456-426614174000'
            responses:
                '200':
                    description: New list ingredients returned
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/RecipeIngredient'
                '401':
                    description: Unauthorized
                '502':
                    description: 'Database insert operation failed'
    /lists:
        get:
            tags:
                - lists
            summary: Get all lists
            description: Get all lists
            operationId: allLists
            responses:
                '200':
                    description: Lists fetched successfully
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    type: array
                                    items:
                                        $ref: '#/components/schemas/ListIngredient'
                '401':
                    description: Unauthorized
                '502':
                    description: 'Database select operation failed'
        put:
            tags:
                - lists
            summary: Upsert a list ingredient
            description: Upsert a list ingredient
            operationId: UpsertListIngredient
            requestBody:
                $ref: '#/components/requestBodies/List'
            responses:
                '200':
                    description: List ingredient successfully updated
                '401':
                    description: Unauthorized
                '502':
                    description: 'Database update operation failed'
    /lists/delete:
        put:
            tags:
                - lists
            summary: Delete list or list ingredient
            description: Delete list or list ingredient
            operationId: deleteListIngredient
            requestBody:
                description: List uuid or array of ingredient uuids
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                row_uuid:
                                    type: array
                                    items:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                card_uuid:
                                    type: string
                                    format: uuid
                                    example: '123e4567-e89b-12d3-a456-426614174000'
            responses:
                '200':
                    description: List ingredient successfully deleted
                '401':
                    description: Unauthorized
                '502':
                    description: 'Database delete operation failed'
components:
    schemas:
        User:
            type: object
            properties:
                uuid:
                    type: string
                    format: uuid
                    example: '123e4567-e89b-12d3-a456-426614174000'
                email:
                    type: string
                    format: email
                    example: 'example@domain.com'
                language:
                    type: string
                    example: ENG
                theme:
                    type: string
                    example: light
                google_name:
                    type: string
                    example: John Smith
                avatar_variant:
                    type: string
                    example: marble
                avatar_colors:
                    type: array
                    items:
                        type: string
                        example: '#92A1C6'
                    minItems: 5
                    maxItems: 5
                layouts_recipes:
                    type: object
                    properties:
                        lg:
                            type: array
                            items:
                                type: object
                                properties:
                                    i:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                    x:
                                        type: integer
                                        format: int32
                                        example: 0
                                    y:
                                        type: integer
                                        format: int32
                                        example: 0
                                    w:
                                        type: integer
                                        format: int32
                                        example: 2
                                    h:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    maxW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    maxH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    isBounded:
                                        type: boolean
                                        example: true
                        md:
                            type: array
                            items:
                                type: object
                                properties:
                                    i:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                    x:
                                        type: integer
                                        format: int32
                                        example: 0
                                    y:
                                        type: integer
                                        format: int32
                                        example: 0
                                    w:
                                        type: integer
                                        format: int32
                                        example: 2
                                    h:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    maxW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    maxH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    isBounded:
                                        type: boolean
                                        example: true
                        sm:
                            type: array
                            items:
                                type: object
                                properties:
                                    i:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                    x:
                                        type: integer
                                        format: int32
                                        example: 0
                                    y:
                                        type: integer
                                        format: int32
                                        example: 0
                                    w:
                                        type: integer
                                        format: int32
                                        example: 2
                                    h:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    maxW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    maxH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    isBounded:
                                        type: boolean
                                        example: true
                        xs:
                            type: array
                            items:
                                type: object
                                properties:
                                    i:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                    x:
                                        type: integer
                                        format: int32
                                        example: 0
                                    y:
                                        type: integer
                                        format: int32
                                        example: 0
                                    w:
                                        type: integer
                                        format: int32
                                        example: 2
                                    h:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    maxW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    maxH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    isBounded:
                                        type: boolean
                                        example: true
                        xxs:
                            type: array
                            items:
                                type: object
                                properties:
                                    i:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                    x:
                                        type: integer
                                        format: int32
                                        example: 0
                                    y:
                                        type: integer
                                        format: int32
                                        example: 0
                                    w:
                                        type: integer
                                        format: int32
                                        example: 2
                                    h:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    maxW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    maxH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    isBounded:
                                        type: boolean
                                        example: true
                layouts_lists:
                    type: object
                    properties:
                        lg:
                            type: array
                            items:
                                type: object
                                properties:
                                    i:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                    x:
                                        type: integer
                                        format: int32
                                        example: 0
                                    y:
                                        type: integer
                                        format: int32
                                        example: 0
                                    w:
                                        type: integer
                                        format: int32
                                        example: 2
                                    h:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    maxW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    maxH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    isBounded:
                                        type: boolean
                                        example: true
                        md:
                            type: array
                            items:
                                type: object
                                properties:
                                    i:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                    x:
                                        type: integer
                                        format: int32
                                        example: 0
                                    y:
                                        type: integer
                                        format: int32
                                        example: 0
                                    w:
                                        type: integer
                                        format: int32
                                        example: 2
                                    h:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    maxW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    maxH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    isBounded:
                                        type: boolean
                                        example: true
                        sm:
                            type: array
                            items:
                                type: object
                                properties:
                                    i:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                    x:
                                        type: integer
                                        format: int32
                                        example: 0
                                    y:
                                        type: integer
                                        format: int32
                                        example: 0
                                    w:
                                        type: integer
                                        format: int32
                                        example: 2
                                    h:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    maxW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    maxH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    isBounded:
                                        type: boolean
                                        example: true
                        xs:
                            type: array
                            items:
                                type: object
                                properties:
                                    i:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                    x:
                                        type: integer
                                        format: int32
                                        example: 0
                                    y:
                                        type: integer
                                        format: int32
                                        example: 0
                                    w:
                                        type: integer
                                        format: int32
                                        example: 2
                                    h:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    maxW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    maxH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    isBounded:
                                        type: boolean
                                        example: true
                        xxs:
                            type: array
                            items:
                                type: object
                                properties:
                                    i:
                                        type: string
                                        format: uuid
                                        example: '123e4567-e89b-12d3-a456-426614174000'
                                    x:
                                        type: integer
                                        format: int32
                                        example: 0
                                    y:
                                        type: integer
                                        format: int32
                                        example: 0
                                    w:
                                        type: integer
                                        format: int32
                                        example: 2
                                    h:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    maxW:
                                        type: integer
                                        format: int32
                                        example: 2
                                    minH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    maxH:
                                        type: integer
                                        format: int32
                                        example: 5
                                    isBounded:
                                        type: boolean
                                        example: true
        RecipeIngredient:
            type: object
            properties:
                uuid:
                    type: string
                    format: uuid
                    example: '123e4567-e89b-12d3-a456-426614174000'
                user_uuid:
                    type: string
                    format: uuid
                    example: '123e4567-e89b-12d3-a456-426614174000'
                card_uuid:
                    type: string
                    format: uuid
                    example: '123e4567-e89b-12d3-a456-426614174000'
                title:
                    type: string
                    example: Lasagna
                ingredient:
                    type: string
                    example: tomato sauce
                quantity:
                    type: number
                    example: 400
                unit:
                    type: string
                    example: ml
                section:
                    type: string
                    example: seasonings
                kCal:
                    type: number
                    example: 0
                last_modified:
                    type: string
                    format: date-time
                    example: '2023-01-01 16:07:18.103861+00'
                index:
                    type: number
                    example: 1
        ListIngredient:
            type: object
            properties:
                uuid:
                    type: string
                    format: uuid
                    example: '123e4567-e89b-12d3-a456-426614174000'
                user_uuid:
                    type: string
                    format: uuid
                    example: '123e4567-e89b-12d3-a456-426614174000'
                card_uuid:
                    type: string
                    format: uuid
                    example: '123e4567-e89b-12d3-a456-426614174000'
                title:
                    type: string
                    example: Italian
                checked:
                    type: boolean
                    example: false
                ingredient:
                    type: string
                    example: tomato sauce
                quantity:
                    type: number
                    example: 400
                unit:
                    type: string
                    example: ml
                section:
                    type: string
                    example: seasonings
                index:
                    type: number
                    example: 1
                last_modified:
                    type: string
                    format: date-time
                    example: '2023-01-01 16:07:18.103861+00'
                recipes:
                    type: array
                    items:
                        type: string
                        example: 'Lasagna'
    requestBodies:
        Recipe:
            description: Array of recipe ingredients
            required: true
            content:
                application/json:
                    schema:
                        type: array
                        items:
                            $ref: '#/components/schemas/RecipeIngredient'
        List:
            description: Array of list ingredients
            required: true
            content:
                application/json:
                    schema:
                        type: array
                        items:
                            $ref: '#/components/schemas/ListIngredient'
        User:
            description: User properties to update
            required: true
            content:
                application/json:
                    schema:
                        type: object
                        properties:
                            some column:
                                type: string
                                example: 'value'
                            some other column:
                                type: string
                                example: 'value'
